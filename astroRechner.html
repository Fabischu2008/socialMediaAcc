<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weg der Erleuchtung - Astro Rechner</title>
  <meta name="description" content="Folge @weg.der.erleuchtung f√ºr Inspiration, Achtsamkeit & kosmische Klarheit. Dein spiritueller Kompass auf Instagram,Tiktok,Facebook.">

  <link rel="icon" type="image/png" href="logo1.svg">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>

  <style>
    /* --- CUSTOM STYLES --- */
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    label { font-weight: 600; font-size: 0.9rem; color: #444; }

    .form-control-astro {
      width: 100%; padding: 12px; margin-top: 6px;
      border: 1px solid #ced4da; border-radius: 8px;
      font-size: 1rem; box-sizing: border-box;
      background: #fff;
    }

    .form-control-astro:focus {
      border-color: #3498db;
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    input[readonly] { background: #f8f9fa; color: #888; cursor: default; }

    /* --- Suchergebnisse --- */
    .search-wrapper { position: relative; }

    #cityResults {
      position: absolute;
      top: 100%; left: 0; right: 0;
      background: white;
      border: 1px solid #ced4da;
      border-top: none;
      border-radius: 0 0 8px 8px;
      max-height: 250px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .city-item {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 1px solid #f0f0f0;
      font-size: 0.95rem;
    }
    .city-item:last-child { border-bottom: none; }
    .city-item:hover {
      background-color: #f0f7ff;
      color: #3498db;
    }
    .city-item small { display: block; color: #888; font-size: 0.8em; margin-top: 2px; }

    /* Lade-Spinner */
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 30px auto;
      display: none;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Buttons */
    button.btn-calc {
      width: 100%; margin-top: 25px; padding: 14px;
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white; border: none; border-radius: 8px;
      font-size: 1.1em; font-weight: 700; cursor: pointer;
      transition: transform 0.1s, box-shadow 0.2s;
    }
    button.btn-calc:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
      color: white;
    }

    .btn-cta {
      background-color: #fce51f;
      color: #000;
      border: none;
      padding: 12px 25px;
      font-weight: bold;
      text-decoration: none;
      border-radius: 8px;
      display: inline-block;
      transition: transform 0.2s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .btn-cta:hover {
      background-color: #e6d010;
      transform: translateY(-2px);
      color: #000;
    }

    /* Status & Output */
    #status { text-align: center; font-size: 0.85em; margin-bottom: 20px; padding: 8px; border-radius: 6px; }
    .status-ok { background: #e8f5e9; color: #2e7d32; }
    .status-err { background: #ffebee; color: #c62828; }
    .status-wait { background: #fff3e0; color: #ef6c00; }

    #output { margin-top: 30px; border-top: 2px solid #f5f5f5; padding-top: 20px; display:none; }
    table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
    tr { background: #fff; }
    td { padding: 12px 8px; border-bottom: 1px solid #f5f5f5; vertical-align: middle; }

    .interpretation-box {
      background: #f8f9fa;
      border-left: 4px solid #3498db;
      padding: 15px;
      margin-top: 30px;
      border-radius: 4px;
    }
    .interpretation-title { font-weight: bold; color: #2c3e50; margin-bottom: 5px; display: block; }
    .interpretation-text { font-size: 0.95rem; color: #555; line-height: 1.5; }

    .badge-elem { padding: 5px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 700; display: inline-block; min-width: 90px; text-align: center; text-transform: uppercase; letter-spacing: 0.5px; }
    .fire { background:#ffebee; color:#d32f2f; }
    .earth { background:#e8f5e9; color:#388e3c; }
    .air { background:#e3f2fd; color:#1976d2; }
    .water { background:#e0f7fa; color:#0097a7; }

    .error-msg { color: #c62828; background: #ffebee; padding: 15px; border-radius: 8px; margin-top: 15px; font-weight: bold; text-align: center;}
    .calc-info { text-align: center; font-size: 0.8em; color: #999; margin-top: 10px; }
  </style>
</head>
<body>

<header class="py-3 border-bottom bg-white shadow-sm" style="position:relative; z-index: 10;">
  <div class="container">
    <nav class="navbar navbar-expand-lg navbar-light">
      <a class="navbar-brand fw-bold d-flex align-items-center" href="index.html">
        <img src="logo.png" onerror="this.style.display='none'" alt="Logo" height="70" class="me-2" />
        <small class="text-muted" style="font-size: 1.2rem;">Weg der Erleuchtung</small>
      </a>

      <div class="collapse navbar-collapse justify-content-end" id="mainNavbar">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="angebot.html"></a>
          </li>
          <li class="nav-item"><a class="nav-link" href="#kontakt"></a></li>
        </ul>
      </div>
    </nav>
  </div>
</header>

<section class="position-relative d-flex align-items-center flex-grow-1"
         style="background:url('1.jpg') center/cover no-repeat; min-height:90vh; padding-top: 40px; padding-bottom: 80px;">

  <div class="position-absolute top-0 start-0 w-100 h-100"
       style="background: rgba(0,0,0,0);"></div>

  <div class="container position-relative" style="z-index: 2;">
    <div class="row justify-content-center">
      <div class="col-md-7 col-lg-6">

        <div class="text-center text-white mb-4">
          <h2 class="fw-bold mb-2">Dein Horoskop</h2>
          <p class="lead mb-0">
            Berechne dein Chart exakt f√ºr jeden Ort der Welt.
          </p>
          <p class="lead mb-0">
            Suche einfach nach deinem Geburtsort (z.B. "M√ºnchen").
          </p>
        </div>


        <div class="bg-white p-4 p-md-5 rounded-3 shadow">

          <div id="status" class="status-wait">Lade System...</div>

          <form id="astroForm">

            <div class="mb-3 search-wrapper">
              <label for="citySearch">Geburtsort suchen:</label>
              <div id="searchSpinner" class="spinner-border text-primary spinner-border-sm position-absolute" style="right: 15px; top: 42px; display: none; z-index: 5;" role="status"></div>
              <input type="text" id="citySearch" class="form-control-astro" placeholder="Tippe deinen Ort (z.B. M√ºnchen)..." autocomplete="off">
              <div id="cityResults"></div>
            </div>

            <div class="row g-2 mb-3">
              <div class="col-6">
                <label style="font-size:0.8em">Breitengrad</label>
                <input type="text" id="lat" class="form-control-astro" readonly placeholder="-">
              </div>
              <div class="col-6">
                <label style="font-size:0.8em">L√§ngengrad</label>
                <input type="text" id="lon" class="form-control-astro" readonly placeholder="-">
              </div>
            </div>

            <div class="mb-3">
              <label for="date">Geburtsdatum:</label>
              <input type="date" id="date" class="form-control-astro">
            </div>

            <div class="mb-3">
              <label for="time">Geburtszeit:</label>
              <input type="time" id="time" class="form-control-astro">
            </div>

            <button type="button" class="btn-calc" onclick="calculate()">Jetzt Berechnen</button>
            <div id="calcInfo" class="calc-info"></div>
          </form>

          <div id="loader" class="loader"></div>
          <div id="output"></div>

        </div>

      </div>
    </div>
  </div>
</section>

<footer id="kontakt" class="text-white position-relative pt-5 pb-4"
        style="background: #2c3e50 url('1.svg') center center / cover no-repeat;">

  <div class="position-absolute top-0 start-0 w-100 h-100"
       style="background: rgba(0, 0, 0, 0.5); z-index: 1;"></div>

  <div class="container position-relative" style="z-index: 2;">
    <div class="row g-4">
      <div class="col-md-4">
        <h5 class="mb-3">Kontakt</h5>
        <p class="mb-1">üìß <strong>E-Mail:</strong><br>
          <a href="mailto:info.wegdererleuchtung@gmail.com" class="text-white text-decoration-none">info.wegdererleuchtung@gmail.com</a>
        </p>
        <p class="mb-0">üí¨ <strong>WhatsApp:</strong><br>
          <a href="https://wa.me/4915259527957" class="text-white text-decoration-none">+49 1525 9527957</a>
        </p>
      </div>

      <div class="col-md-4">
        <h5 class="mb-3">Schnellzugriff</h5>
        <ul class="list-unstyled">
          <li><a href="index.html" class="text-white text-decoration-none">Start</a></li>
        </ul>
      </div>

      <div class="col-md-4">
        <h5 class="mb-3">Weg der Erleuchtung</h5>
        <p class="mb-2">
          Spirituelle Begleitung mit Herz ‚Äì f√ºr Menschen, die mehr Tiefe, Klarheit und Bewusstsein in ihr Leben bringen m√∂chten.
        </p>
        <ul class="list-inline mt-3">
          <li class="list-inline-item">
            <a href="https://instagram.com/weg.der.erleuchtung" class="text-white fs-5 me-2"><i class="bi bi-instagram"></i></a>
            <a href="https://www.tiktok.com/@weg.der.erleuchtung?lang=de-DE" class="text-white fs-5 me-2"><i class="bi bi-tiktok"></i></a>
          </li>
        </ul>
      </div>
    </div>

    <hr class="border-secondary mt-5">

    <div class="row">
      <div class="col-md-6">
        <ul class="list-inline mb-0">
          <li class="list-inline-item"><a href="impressum.html" class="text-white text-decoration-none">Impressum</a></li>
          <li class="list-inline-item mx-2">|</li>
          <li class="list-inline-item"><a href="datenschutz.html" class="text-white text-decoration-none">Datenschutz</a></li>
          <li class="list-inline-item mx-2">|</li>
          <li class="list-inline-item"><a href="agb.html" class="text-white text-decoration-none">AGB</a></li>
        </ul>
      </div>
      <div class="col-md-6 text-md-end mt-3 mt-md-0">
        <small>&copy; 2025 Weg der Erleuchtung ‚Äì mit Liebe & Klarheit gestaltet.</small>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// --- 1. DATEN ---
const ZODIAC = [
  {name: "Widder", icon: "‚ôà", elm: "fire"}, {name: "Stier", icon: "‚ôâ", elm: "earth"},
  {name: "Zwillinge", icon: "‚ôä", elm: "air"}, {name: "Krebs", icon: "‚ôã", elm: "water"},
  {name: "L√∂we", icon: "‚ôå", elm: "fire"}, {name: "Jungfrau", icon: "‚ôç", elm: "earth"},
  {name: "Waage", icon: "‚ôé", elm: "air"}, {name: "Skorpion", icon: "‚ôè", elm: "water"},
  {name: "Sch√ºtze", icon: "‚ôê", elm: "fire"}, {name: "Steinbock", icon: "‚ôë", elm: "earth"},
  {name: "Wassermann", icon: "‚ôí", elm: "air"}, {name: "Fische", icon: "‚ôì", elm: "water"}
];

const SIGN_TEXTS = {
  "Widder": "Du bist ein energiegeladener Pionier. Deine Willenskraft und dein Mut treiben dich an, neue Wege zu gehen.",
  "Stier": "Du suchst Sicherheit und Best√§ndigkeit. Du genie√üt die sch√∂nen Seiten des Lebens und bist ein Fels in der Brandung.",
  "Zwillinge": "Du bist kommunikativ und vielseitig interessiert. Dein Geist ist immer wach, und du liebst den Austausch.",
  "Krebs": "Du bist gef√ºhlsbetont und f√ºrsorglich. Deine Intuition ist stark, und Familie/Heim bedeuten dir alles.",
  "L√∂we": "Du strahlst W√§rme und Selbstbewusstsein aus. Du f√ºhrst gerne und inspirierst andere mit deiner Kreativit√§t.",
  "Jungfrau": "Du hast einen Blick f√ºrs Detail und liebst Ordnung. Deine analytische Art hilft dir, Probleme effizient zu l√∂sen.",
  "Waage": "Du strebst nach Harmonie und Gerechtigkeit. Beziehungen sind dir wichtig, und du hast Sinn f√ºr √Ñsthetik.",
  "Skorpion": "Du gehst den Dingen auf den Grund. Deine Gef√ºhle sind tief und intensiv, du hast eine starke Ausstrahlung.",
  "Sch√ºtze": "Du bist ein Optimist auf der Suche nach dem Sinn. Freiheit und Reisen erweitern deinen Horizont.",
  "Steinbock": "Du bist ehrgeizig und verantwortungsbewusst. Mit Geduld und Disziplin erreichst du deine hohen Ziele.",
  "Wassermann": "Du bist ein Individualist und Vision√§r. Freiheit und Unabh√§ngigkeit sind dir wichtiger als Konventionen.",
  "Fische": "Du bist sensibel und fantasievoll. Dein Mitgef√ºhl ist gro√ü, und du hast eine Verbindung zum Spirituellen."
};

const PLANETS = {
  "Sun": "Sonne", "Moon": "Mond", "Mercury": "Merkur", "Venus": "Venus", "Mars": "Mars",
  "Jupiter": "Jupiter", "Saturn": "Saturn", "Uranus": "Uranus", "Neptune": "Neptun", "Pluto": "Pluto",
  "Ascendant": "Aszendent"
};

const BASE_CITIES = [
  {n:"Berlin", lat:52.52, lon:13.40}, {n:"Hamburg", lat:53.55, lon:9.99}, {n:"M√ºnchen", lat:48.13, lon:11.58},
  {n:"K√∂ln", lat:50.93, lon:6.96}, {n:"Wien", lat:48.20, lon:16.37}, {n:"Z√ºrich", lat:47.37, lon:8.54},
  {n:"Frankfurt am Main", lat:50.11, lon:8.68}, {n:"Stuttgart", lat:48.77, lon:9.18}
];

// --- 2. INIT ---
window.onload = function() {
  const statusDiv = document.getElementById("status");
  if (typeof Astronomy !== 'undefined') {
    statusDiv.className = "status-ok";
    statusDiv.innerText = "System bereit";
    initSearch();
  } else {
    statusDiv.className = "status-err";
    statusDiv.innerText = "Fehler: Bibliothek nicht geladen.";
  }
};

// --- 3. LIVE SUCHE (OpenStreetMap) ---
let debounceTimer;

function initSearch() {
  const searchInput = document.getElementById("citySearch");
  const resultsBox = document.getElementById("cityResults");
  const spinner = document.getElementById("searchSpinner");

  searchInput.addEventListener("input", function() {
    const query = this.value.trim();
    if(query.length < 2) {
      resultsBox.style.display = "none";
      spinner.style.display = "none";
      return;
    }
    spinner.style.display = "block";
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => { fetchCities(query); }, 400);
  });

  document.addEventListener("click", function(e) {
    if (e.target !== searchInput) resultsBox.style.display = "none";
  });
}

async function fetchCities(query) {
  const resultsBox = document.getElementById("cityResults");
  const spinner = document.getElementById("searchSpinner");

  try {
    const localMatches = BASE_CITIES.filter(c => c.n.toLowerCase().includes(query.toLowerCase()));
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&accept-language=de`;
    const response = await fetch(url);
    const data = await response.json();

    resultsBox.innerHTML = "";

    if(localMatches.length > 0) {
      localMatches.forEach(city => createResultItem(city.n, city.lat, city.lon, "Gro√üstadt"));
    }
    if(data && data.length > 0) {
      data.forEach(place => {
        if(!localMatches.some(l => l.n === place.name)) {
           createResultItem(place.display_name, place.lat, place.lon, "");
        }
      });
    }
    if(localMatches.length === 0 && data.length === 0) {
      const div = document.createElement("div");
      div.className = "city-item text-muted";
      div.innerText = "Kein Ort gefunden.";
      resultsBox.appendChild(div);
    }
    resultsBox.style.display = "block";
  } catch (error) {
    console.error("Fehler:", error);
  } finally {
    spinner.style.display = "none";
  }
}

function createResultItem(name, lat, lon, extraInfo) {
  const resultsBox = document.getElementById("cityResults");
  const searchInput = document.getElementById("citySearch");
  const div = document.createElement("div");
  div.className = "city-item";

  const parts = name.split(",");
  const mainName = parts[0];
  let details = "";
  if(parts.length > 1) details = parts.slice(1, 3).join(", ");

  div.innerHTML = `<strong>${mainName}</strong> <small>${details}</small>`;

  div.onclick = function() {
    document.getElementById("lat").value = parseFloat(lat).toFixed(4);
    document.getElementById("lon").value = parseFloat(lon).toFixed(4);
    searchInput.value = mainName;
    resultsBox.style.display = "none";
  };
  resultsBox.appendChild(div);
}

// --- 4. HELPER & BERECHNUNG ---
function mod(x, y) { return ((x % y) + y) % y; }

function getZod(deg) {
  const i = Math.floor(deg / 30);
  const z = ZODIAC[mod(i, 12)];
  const d = Math.floor(deg % 30);
  const m = Math.floor((deg % 1) * 60);
  return { sign: z, txt: `${d}¬∞ ${m}'` };
}

function getObliquity(dateObj) {
  const J2000 = new Date("2000-01-01T12:00:00Z");
  const days = (dateObj - J2000) / 86400000;
  const T = days / 36525;
  return 23.43929 - (0.0130041 * T);
}

// ‚≠êÔ∏è CORE FUNCTION: Calculate (Timezone Independent)
function calculate() {
  const out = document.getElementById("output");
  const loader = document.getElementById("loader");
  const infoBox = document.getElementById("calcInfo");

  out.style.display = 'none';
  out.innerHTML = "";
  infoBox.innerHTML = "";

  const dStr = document.getElementById("date").value;
  const tStr = document.getElementById("time").value;
  const latVal = document.getElementById("lat").value;
  const lonVal = document.getElementById("lon").value;

  if(!latVal || !lonVal) { alert("Bitte w√§hle zuerst einen Geburtsort aus der Liste."); return; }
  if(!dStr || !tStr) { alert("Bitte f√ºlle Datum und Zeit aus."); return; }

  loader.style.display = 'block';

  setTimeout(() => {
    try {
      if (typeof Astronomy === 'undefined') throw new Error("Bibliothek fehlt.");

      const lat = parseFloat(latVal);
      const lon = parseFloat(lonVal);

      // --- ZEITZONEN LOGIK START ---
      // Wir ignorieren die Browser-Zeit und bauen uns eine "Ortszeit"
      const [year, month, day] = dStr.split('-').map(Number);
      const [hour, minute] = tStr.split(':').map(Number);

      // 1. Sch√§tze Zeitzone basierend auf L√§ngengrad (15¬∞ = 1 Stunde)
      let offset = Math.round(lon / 15);

      // 2. Sommerzeit-Logik (Grob f√ºr Nordhalbkugel, aber sicher f√ºr Tropen)
      // Nur anwenden wenn Breitengrad > 25 (also nicht in Thailand/Tropen)
      // und Monat zwischen April und Oktober.
      let isDST = false;
      if(lat > 25 && (month >= 4 && month <= 10)) {
        offset += 1;
        isDST = true;
      }

      // 3. Erstelle UTC Date Objekt durch manuelles Abziehen des Offsets
      const date = new Date(Date.UTC(year, month - 1, day, hour - offset, minute));

      // Info anzeigen
      const sign = offset >= 0 ? "+" : "";
      infoBox.innerText = `Verwendete Zeitzone: UTC${sign}${offset} ${isDST ? '(Sommerzeit)' : ''}`;
      // --- ZEITZONEN LOGIK ENDE ---

      let list = [];
      const bodies = ["Sun", "Moon", "Mercury", "Venus", "Mars", "Jupiter", "Saturn", "Uranus", "Neptune", "Pluto"];

      bodies.forEach(b => {
        const vec = Astronomy.GeoVector(Astronomy.Body[b], date, true);
        const elon = Astronomy.Ecliptic(vec).elon;
        list.push({ key: b, val: elon });
      });

      const gmst = Astronomy.SiderealTime(date);
      const ramc = gmst * 15 + lon;
      const obl = getObliquity(date);
      const eps = obl * Math.PI / 180;
      const latRad = lat * Math.PI / 180;
      const ramcRad = ramc * Math.PI / 180;
      const acRad = Math.atan2(Math.cos(ramcRad), -Math.sin(ramcRad) * Math.cos(eps) - Math.tan(latRad) * Math.sin(eps));
      list.push({ key: "Ascendant", val: mod(acRad * 180 / Math.PI, 360) });

      const order = ["Sun", "Moon", "Ascendant", "Mercury", "Venus", "Mars", "Jupiter", "Saturn", "Uranus", "Neptune", "Pluto"];
      list.sort((a,b) => order.indexOf(a.key) - order.indexOf(b.key));

      let html = "<table>";
      let sunSign = "";
      let acSign = "";

      list.forEach(item => {
        const z = getZod(item.val);
        const name = PLANETS[item.key];
        const style = ["Sun","Moon","Ascendant"].includes(item.key) ? "font-weight:bold; color:#2c3e50;" : "color:#666;";

        if(item.key === "Sun") sunSign = z.sign.name;
        if(item.key === "Ascendant") acSign = z.sign.name;

        html += `<tr>
          <td style="${style}">${name}</td>
          <td><span class="badge-elem ${z.sign.elm}">${z.sign.icon} ${z.sign.name}</span></td>
          <td style="text-align:right; font-family:monospace; color:#888;">${z.txt}</td>
        </tr>`;
      });
      html += "</table>";

      if(sunSign && acSign) {
          html += `<div class="interpretation-box">
              <span class="interpretation-title">Dein Kern (Sonne in ${sunSign}):</span>
              <p class="interpretation-text">${SIGN_TEXTS[sunSign]}</p>
              <span class="interpretation-title mt-3">Deine Wirkung (Aszendent in ${acSign}):</span>
              <p class="interpretation-text mb-0">${SIGN_TEXTS[acSign]}</p>
          </div>`;
      }

      html += `<div class="text-center mt-4">
          <p class="mb-2 text-muted" style="font-size:0.9em">Das war nur der Anfang. Erfahre, was die Sterne wirklich f√ºr dich bereithalten.</p>
          <a href="form.html" class="btn-cta">
             Pers√∂nliche Deutung anfragen <i class="bi bi-arrow-right ms-1"></i>
          </a>
      </div>`;

      loader.style.display = 'none';
      out.innerHTML = html;
      out.style.display = 'block';

    } catch (err) {
      loader.style.display = 'none';
      out.style.display = 'block';
      out.innerHTML = `<div class="error-msg">Hoppla: ${err.message}</div>`;
    }
  }, 800);
}
</script>

</body>
</html>